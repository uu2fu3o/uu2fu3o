import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,a as t,o as n}from"./app-DS0ZCcmM.js";const r={};function o(p,e){return n(),i("div",null,e[0]||(e[0]=[t('<h1 id="组策略的一些利用" tabindex="-1"><a class="header-anchor" href="#组策略的一些利用"><span>组策略的一些利用</span></a></h1><h2 id="sysvol-漏洞-ms14-025" tabindex="-1"><a class="header-anchor" href="#sysvol-漏洞-ms14-025"><span>SYSVOL 漏洞(MS14-025)</span></a></h2><p>在早期的版本，某些组策略首选项可以存储加密过的密码，加密方式为AES 256，虽然目前AES 256很难被攻破，但是微软选择公开了私钥:)</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/t016b35d9da99ba64ad.png" alt="t016b35d9da99ba64ad" tabindex="0" loading="lazy"><figcaption>t016b35d9da99ba64ad</figcaption></figure><p>主要存在于以下组策略首选项中</p><ul><li>驱动器映射</li><li>本地用户和组</li><li>计划任务</li><li>服务</li><li>数据源</li></ul><p>接下来通过设置计划任务来利用一下</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203117459.png" alt="image-20231128203117459" tabindex="0" loading="lazy"><figcaption>image-20231128203117459</figcaption></figure><p>它会提醒你这是能被检测到的。你可以通过这段代码来检测</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>findstr /S cpassword \\\\hack.com\\sysvol\\*.xml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203324524.png" alt="image-20231128203324524" tabindex="0" loading="lazy"><figcaption>image-20231128203324524</figcaption></figure><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203345548.png" alt="image-20231128203345548" tabindex="0" loading="lazy"><figcaption>image-20231128203345548</figcaption></figure><p>能看到被加密过后的cpassword,通过kali自带的gpp-decrypt能够解密该字符串</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203926394.png" alt="image-20231128203926394" tabindex="0" loading="lazy"><figcaption>image-20231128203926394</figcaption></figure><p>不过在高版本的winserver并不能指定运行用户了，这一条计划任务是在2012上设置</p><h2 id="利用组策略扩展" tabindex="-1"><a class="header-anchor" href="#利用组策略扩展"><span>利用组策略扩展</span></a></h2><p>拿下域控之后，网络ACL无法到达的机器，可以通过组策略来横向</p><h3 id="在-软件安装-下推出-msi" tabindex="-1"><a class="header-anchor" href="#在-软件安装-下推出-msi"><span>在“软件安装”下推出.msi</span></a></h3><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128210847955.png" alt="image-20231128210847955" tabindex="0" loading="lazy"><figcaption>image-20231128210847955</figcaption></figure><p>受这条组策略影响的计算机在重启后会更新组策略，自动安装该msi包</p><h3 id="推出特定的启动脚本" tabindex="-1"><a class="header-anchor" href="#推出特定的启动脚本"><span>推出特定的启动脚本</span></a></h3><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128211311246.png" alt="image-20231128211311246" tabindex="0" loading="lazy"><figcaption>image-20231128211311246</figcaption></figure><h3 id="计划任务" tabindex="-1"><a class="header-anchor" href="#计划任务"><span>计划任务</span></a></h3><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128211713442.png" alt="image-20231128211713442" tabindex="0" loading="lazy"><figcaption>image-20231128211713442</figcaption></figure><h2 id="组策略后门" tabindex="-1"><a class="header-anchor" href="#组策略后门"><span>组策略后门</span></a></h2><h3 id="将域帐户添加到本地管理员-rdp组" tabindex="-1"><a class="header-anchor" href="#将域帐户添加到本地管理员-rdp组"><span>将域帐户添加到本地管理员/ RDP组</span></a></h3><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128212918591.png" alt="image-20231128212918591" tabindex="0" loading="lazy"><figcaption>image-20231128212918591</figcaption></figure><h3 id="添加特权" tabindex="-1"><a class="header-anchor" href="#添加特权"><span>添加特权</span></a></h3><p>可以通过组策略给某个用户授予特权。 我们用的比较多的有SeEnableDelegationPrivilege特权</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128215027741.png" alt="image-20231128215027741" tabindex="0" loading="lazy"><figcaption>image-20231128215027741</figcaption></figure><h3 id="降级凭据保护" tabindex="-1"><a class="header-anchor" href="#降级凭据保护"><span>降级凭据保护</span></a></h3><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128215245210.png" alt="image-20231128215245210" tabindex="0" loading="lazy"><figcaption>image-20231128215245210</figcaption></figure><h3 id="更改现有的安全策略以启用明文密码提取" tabindex="-1"><a class="header-anchor" href="#更改现有的安全策略以启用明文密码提取"><span>更改现有的安全策略以启用明文密码提取</span></a></h3><p>微软很早就更新了补丁来防止获取高版本windows的明文密码，但是可以修改注册表... 使 \\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest下的UseLogonCredentiald的键值为1</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128215604584.png" alt="image-20231128215604584" tabindex="0" loading="lazy"><figcaption>image-20231128215604584</figcaption></figure><h3 id="组策略acl-后门" tabindex="-1"><a class="header-anchor" href="#组策略acl-后门"><span>组策略ACL 后门</span></a></h3><p>组策略相关的ACL里面有提到三种特权</p><ol><li>创建GPO的权限</li><li>GPO链接OU的权限。</li><li>修改现有的GPO的权限</li></ol><p>即利用方式为给用户添加对某条组策略的修改权限来控制该条GPO，比如拥有修改Default Domain Policy的权限，那么这个用户就可以授予别的用户SeEnableDelegationPrivilege的权限。赋予某个用户创建GPO ，以及链接到域的权限，那么这个用户其实就等效于域管了。</p><h3 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接"><span>参考链接</span></a></h3><p><a href="https://daiker.gitbook.io/windows-protocol/ldap-pian/11" target="_blank" rel="noopener noreferrer">Windows Protocol</a></p><p><a href="https://learn.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-start-page" target="_blank" rel="noopener noreferrer">microsoft</a></p><p><a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C" target="_blank" rel="noopener noreferrer">域渗透-利用GPO中的脚本实现远程执行</a></p>',43)]))}const u=a(r,[["render",o],["__file","组策略的一些利用.html.vue"]]),s=JSON.parse('{"path":"/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/LDAP%E4%B8%93%E9%A2%98/%E7%BB%84%E7%AD%96%E7%95%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%A9%E7%94%A8.html","title":"组策略的一些利用","lang":"zh-CN","frontmatter":{"description":"组策略的一些利用 SYSVOL 漏洞(MS14-025) 在早期的版本，某些组策略首选项可以存储加密过的密码，加密方式为AES 256，虽然目前AES 256很难被攻破，但是微软选择公开了私钥:) t016b35d9da99ba64adt016b35d9da99ba64ad 主要存在于以下组策略首选项中 驱动器映射 本地用户和组 计划任务 服务 数据源...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/LDAP%E4%B8%93%E9%A2%98/%E7%BB%84%E7%AD%96%E7%95%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%A9%E7%94%A8.html"}],["meta",{"property":"og:site_name","content":"uu2fu3o的知识库"}],["meta",{"property":"og:title","content":"组策略的一些利用"}],["meta",{"property":"og:description","content":"组策略的一些利用 SYSVOL 漏洞(MS14-025) 在早期的版本，某些组策略首选项可以存储加密过的密码，加密方式为AES 256，虽然目前AES 256很难被攻破，但是微软选择公开了私钥:) t016b35d9da99ba64adt016b35d9da99ba64ad 主要存在于以下组策略首选项中 驱动器映射 本地用户和组 计划任务 服务 数据源..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/t016b35d9da99ba64ad.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-15T18:41:02.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-15T18:41:02.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"组策略的一些利用\\",\\"image\\":[\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/t016b35d9da99ba64ad.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203117459.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203324524.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203345548.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128203926394.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128210847955.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128211311246.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128211713442.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128212918591.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128215027741.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128215245210.png\\",\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/image-20231128215604584.png\\"],\\"dateModified\\":\\"2025-01-15T18:41:02.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"uu2fu3o\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"SYSVOL 漏洞(MS14-025)","slug":"sysvol-漏洞-ms14-025","link":"#sysvol-漏洞-ms14-025","children":[]},{"level":2,"title":"利用组策略扩展","slug":"利用组策略扩展","link":"#利用组策略扩展","children":[{"level":3,"title":"在“软件安装”下推出.msi","slug":"在-软件安装-下推出-msi","link":"#在-软件安装-下推出-msi","children":[]},{"level":3,"title":"推出特定的启动脚本","slug":"推出特定的启动脚本","link":"#推出特定的启动脚本","children":[]},{"level":3,"title":"计划任务","slug":"计划任务","link":"#计划任务","children":[]}]},{"level":2,"title":"组策略后门","slug":"组策略后门","link":"#组策略后门","children":[{"level":3,"title":"将域帐户添加到本地管理员/ RDP组","slug":"将域帐户添加到本地管理员-rdp组","link":"#将域帐户添加到本地管理员-rdp组","children":[]},{"level":3,"title":"添加特权","slug":"添加特权","link":"#添加特权","children":[]},{"level":3,"title":"降级凭据保护","slug":"降级凭据保护","link":"#降级凭据保护","children":[]},{"level":3,"title":"更改现有的安全策略以启用明文密码提取","slug":"更改现有的安全策略以启用明文密码提取","link":"#更改现有的安全策略以启用明文密码提取","children":[]},{"level":3,"title":"组策略ACL 后门","slug":"组策略acl-后门","link":"#组策略acl-后门","children":[]},{"level":3,"title":"参考链接","slug":"参考链接","link":"#参考链接","children":[]}]}],"git":{"createdTime":1736966462000,"updatedTime":1736966462000,"contributors":[{"name":"uu2fu3o","username":"uu2fu3o","email":"1027578439@qq.com","commits":1,"url":"https://github.com/uu2fu3o"}]},"readingTime":{"minutes":2.34,"words":703},"filePathRelative":"渗透测试/LDAP专题/组策略的一些利用.md","localizedDate":"2025年1月16日","excerpt":"\\n<h2>SYSVOL 漏洞(MS14-025)</h2>\\n<p>在早期的版本，某些组策略首选项可以存储加密过的密码，加密方式为AES 256，虽然目前AES 256很难被攻破，但是微软选择公开了私钥:)</p>\\n<figure><img src=\\"https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ldapp/t016b35d9da99ba64ad.png\\" alt=\\"t016b35d9da99ba64ad\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>t016b35d9da99ba64ad</figcaption></figure>","autoDesc":true}');export{u as comp,s as data};
