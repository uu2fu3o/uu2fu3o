<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.67" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/TGS_REQ_TGS_REP%E9%98%B6%E6%AE%B5%E8%AF%A6%E8%A7%A3.html"><meta property="og:site_name" content="uu2fu3oçš„çŸ¥è¯†åº“"><meta property="og:title" content="TGS_REQ&TGS_REPé˜¶æ®µè¯¦è§£"><meta property="og:description" content="TGS_REQ&TGS_REPé˜¶æ®µè¯¦è§£ è¿™ä¸ªé˜¶æ®µæ‰“ç®—æŠŠå­—æ®µæŒ‘å‡ºæ¥å•ç‹¬ä»‹ç»ä¸€ä¸‹ï¼Œé¡ºä¾¿ä»‹ç»ä»‹ç»å§”æ´¾ TGS_REQ 11 TGS_REQæ•°æ®åŒ…å¦‚ä¸‹ msg-type TGS_REQå¯¹åº”çš„å°±æ˜¯KRB_TGS_REQ(0x0c) PA-DATA AP_REQ è¯¥ç»“æ„ä½“ä¸­å­˜æ”¾ç€AS_REPè·å–åˆ°çš„TGTç¥¨æ®,KDCä¼šæ ¡éªŒä»–æ¥è¿”å›TGSç¥¨æ® PA_FOR_USER..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/1.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-01-15T18:41:02.000Z"><meta property="article:modified_time" content="2025-01-15T18:41:02.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"TGS_REQ&TGS_REPé˜¶æ®µè¯¦è§£","image":["https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/1.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/s4u2self.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/TGTfoward.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/forwardoption.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/2.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/s4u2self2.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/s4u2self3.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/S4U2Proxy.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/addtionticket.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/s4u2proxy2.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/noforwardtgs.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/ziyuanweipai1.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/kezhuanfa.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/s4u.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/feiyueshuweipai.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/image001.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/%E9%9D%9E%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/%E9%9D%9E%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE2.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/hacker.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/useraccount.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/msds'.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E6%B5%81%E7%A8%8B.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/t01fe78dcd0b3af3aa4.jpg","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/service1.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/serviceB.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/%E5%9F%BA%E4%BA%8E%E8%B5%84%E6%BA%90%E7%9A%84%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/step2.png","https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/step3.png"],"dateModified":"2025-01-15T18:41:02.000Z","author":[{"@type":"Person","name":"uu2fu3o","url":"https://mister-hope.com"}]}</script><meta name="referer" content="no-referer"><title>TGS_REQ&TGS_REPé˜¶æ®µè¯¦è§£ | uu2fu3oçš„çŸ¥è¯†åº“</title><meta name="description" content="TGS_REQ&TGS_REPé˜¶æ®µè¯¦è§£ è¿™ä¸ªé˜¶æ®µæ‰“ç®—æŠŠå­—æ®µæŒ‘å‡ºæ¥å•ç‹¬ä»‹ç»ä¸€ä¸‹ï¼Œé¡ºä¾¿ä»‹ç»ä»‹ç»å§”æ´¾ TGS_REQ 11 TGS_REQæ•°æ®åŒ…å¦‚ä¸‹ msg-type TGS_REQå¯¹åº”çš„å°±æ˜¯KRB_TGS_REQ(0x0c) PA-DATA AP_REQ è¯¥ç»“æ„ä½“ä¸­å­˜æ”¾ç€AS_REPè·å–åˆ°çš„TGTç¥¨æ®,KDCä¼šæ ¡éªŒä»–æ¥è¿”å›TGSç¥¨æ® PA_FOR_USER...">
    <link rel="preload" href="/articles/assets/style-SIpkR8pu.css" as="style"><link rel="stylesheet" href="/articles/assets/style-SIpkR8pu.css">
    <link rel="modulepreload" href="/articles/assets/app-DS0ZCcmM.js"><link rel="modulepreload" href="/articles/assets/TGS_REQ_TGS_REPé˜¶æ®µè¯¦è§£.html-vrtIAyOs.js"><link rel="modulepreload" href="/articles/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/articles/assets/index.html-Bg7DAMOU.js" as="script"><link rel="prefetch" href="/articles/assets/Bypass.html-CQtJKDr4.js" as="script"><link rel="prefetch" href="/articles/assets/Fastjsonä¸å‡ºç½‘ç®€å•åˆ©ç”¨.html-CUh5hqJ4.js" as="script"><link rel="prefetch" href="/articles/assets/Fastjsonä¸åŸç”Ÿååºåˆ—åŒ–.html-ETvzwkxT.js" as="script"><link rel="prefetch" href="/articles/assets/åŸºç¡€åˆ©ç”¨é“¾.html-Bi_F-aRy.js" as="script"><link rel="prefetch" href="/articles/assets/æ¢æµ‹ä¸åˆ¤æ–­.html-Dfic0kpM.js" as="script"><link rel="prefetch" href="/articles/assets/ç®€å•ä½¿ç”¨.html-_VS8kRg8.js" as="script"><link rel="prefetch" href="/articles/assets/Hessianååºåˆ—åŒ–.html-5ABeI925.js" as="script"><link rel="prefetch" href="/articles/assets/ç®€ä»‹.html-DgUNlQgn.js" as="script"><link rel="prefetch" href="/articles/assets/ClassLoader.html-jaBmEacR.js" as="script"><link rel="prefetch" href="/articles/assets/Java_Agent.html-D95Lx0Zn.js" as="script"><link rel="prefetch" href="/articles/assets/Javaæ–‡ä»¶ç³»ç»Ÿ.html-DNGfcXUY.js" as="script"><link rel="prefetch" href="/articles/assets/JDBC.html-CyOguz2c.js" as="script"><link rel="prefetch" href="/articles/assets/JNDI.html-DEp66arw.js" as="script"><link rel="prefetch" href="/articles/assets/RMI.html-2OkUSrfd.js" as="script"><link rel="prefetch" href="/articles/assets/åŠ¨æ€ä»£ç†.html-BrhiXGp_.js" as="script"><link rel="prefetch" href="/articles/assets/åå°„.html-DJnN2u7I.js" as="script"><link rel="prefetch" href="/articles/assets/æœ¬åœ°å‘½ä»¤æ‰§è¡Œ.html-BZJ1jxoU.js" as="script"><link rel="prefetch" href="/articles/assets/ç±»åºåˆ—åŒ–.html-V1-awgoa.js" as="script"><link rel="prefetch" href="/articles/assets/ä¸€æ–‡é€Ÿé€š.html-LviL43_4.js" as="script"><link rel="prefetch" href="/articles/assets/550.html-CPpQBphD.js" as="script"><link rel="prefetch" href="/articles/assets/721.html-DPRUhjIK.js" as="script"><link rel="prefetch" href="/articles/assets/ç®€å•ä»‹ç».html-CrJxuJI2.js" as="script"><link rel="prefetch" href="/articles/assets/Servlet.html-BsUacsfD.js" as="script"><link rel="prefetch" href="/articles/assets/SpELè¡¨è¾¾å¼æ³¨å…¥.html-BHTvp0bA.js" as="script"><link rel="prefetch" href="/articles/assets/SpringåŸºç¡€.html-DWZ1eGrz.js" as="script"><link rel="prefetch" href="/articles/assets/Romeååºåˆ—åŒ–.html-DtfvWMl5.js" as="script"><link rel="prefetch" href="/articles/assets/Trace.html-CCtiB5PM.js" as="script"><link rel="prefetch" href="/articles/assets/è®¤è¯†Devops.html-Cw5MjBZS.js" as="script"><link rel="prefetch" href="/articles/assets/Dockerä½¿ç”¨.html-gXoXqPcq.js" as="script"><link rel="prefetch" href="/articles/assets/Dockeræ¼æ´æ±‡æ€».html-USwKDYxu.js" as="script"><link rel="prefetch" href="/articles/assets/Dockerçš„åŸºæœ¬æ¦‚å¿µ.html-C1hJ0LK3.js" as="script"><link rel="prefetch" href="/articles/assets/Dockerçš„åº•å±‚å®ç°.html-fEQF-vnY.js" as="script"><link rel="prefetch" href="/articles/assets/Dockerç½‘ç»œ.html-BKD3QDtG.js" as="script"><link rel="prefetch" href="/articles/assets/K8så…¥é—¨.html-3bXdZGKB.js" as="script"><link rel="prefetch" href="/articles/assets/k8sæ¼æ´.html-COsmps1_.js" as="script"><link rel="prefetch" href="/articles/assets/K8sè¿›é˜¶.html-Bgvvfxgp.js" as="script"><link rel="prefetch" href="/articles/assets/kubectlå¤‡å¿˜å½•.html-BNwoFHMA.js" as="script"><link rel="prefetch" href="/articles/assets/è®¤è¯†K8s.html-DgZSgoNG.js" as="script"><link rel="prefetch" href="/articles/assets/pandas.html-BPTRF8nv.js" as="script"><link rel="prefetch" href="/articles/assets/æ•°æ®å¯è§†åŒ–seaborn.html-CdUcLU4P.js" as="script"><link rel="prefetch" href="/articles/assets/Feature-Engineering.html-vwst1Ea4.js" as="script"><link rel="prefetch" href="/articles/assets/æœºå™¨å­¦ä¹ ç®€ä»‹.html-DiG0diJF.js" as="script"><link rel="prefetch" href="/articles/assets/æœºå™¨å­¦ä¹ è¿›é˜¶.html-2UyQakVn.js" as="script"><link rel="prefetch" href="/articles/assets/2021ç¾äºšæ¯ä¸ªäººèµ›.html-t9ogmCBO.js" as="script"><link rel="prefetch" href="/articles/assets/å–è¯åŸºç¡€.html-BjaU1VQg.js" as="script"><link rel="prefetch" href="/articles/assets/AD_CSåŸºç¡€.html-DQZKJlcP.js" as="script"><link rel="prefetch" href="/articles/assets/AD_CSæ¼æ´åˆ©ç”¨.html-BAePwNBL.js" as="script"><link rel="prefetch" href="/articles/assets/exchaneå¿«é€Ÿäº†è§£.html-CnJ14dA9.js" as="script"><link rel="prefetch" href="/articles/assets/exchaneæ”»å‡»æ‰‹æ³•.html-DgatBQvl.js" as="script"><link rel="prefetch" href="/articles/assets/AS_REQ_AS_REPé˜¶æ®µæ”»å‡».html-Dvd7rnFh.js" as="script"><link rel="prefetch" href="/articles/assets/Kerberosè®¤è¯åŸºç¡€.html-vjDwbWv_.js" as="script"><link rel="prefetch" href="/articles/assets/PAC.html-CVa0PtNi.js" as="script"><link rel="prefetch" href="/articles/assets/Pass-the-ticket.html-CaA_y0GZ.js" as="script"><link rel="prefetch" href="/articles/assets/TGS_REQ_TGS_REPé˜¶æ®µæ”»å‡».html-B_ey6NSw.js" as="script"><link rel="prefetch" href="/articles/assets/å§”æ´¾æ”»å‡»ä¸“é¢˜.html-C_eJ-6Jh.js" as="script"><link rel="prefetch" href="/articles/assets/Active-Directoryç®€ä»‹.html-CVdh-iaa.js" as="script"><link rel="prefetch" href="/articles/assets/åŸŸæƒé™.html-SUvF-mRS.js" as="script"><link rel="prefetch" href="/articles/assets/åŸŸç”¨æˆ·å’Œè®¡ç®—æœºç”¨æˆ·.html-vKm6T84-.js" as="script"><link rel="prefetch" href="/articles/assets/ç‰¹æƒä¸å±é™©ACL.html-C5riArvo.js" as="script"><link rel="prefetch" href="/articles/assets/ç»„å’ŒOUä»‹ç».html-B6uWgahB.js" as="script"><link rel="prefetch" href="/articles/assets/ç»„ç­–ç•¥.html-CtKG8IG-.js" as="script"><link rel="prefetch" href="/articles/assets/ç»„ç­–ç•¥çš„ä¸€äº›åˆ©ç”¨.html-Ddbu1Nzw.js" as="script"><link rel="prefetch" href="/articles/assets/NET-NTLM-hashç ´è§£.html-DG9Mlvoq.js" as="script"><link rel="prefetch" href="/articles/assets/NTLM-Relay.html-BHiAPTko.js" as="script"><link rel="prefetch" href="/articles/assets/NTLMåŸºç¡€.html-DmMVTJbJ.js" as="script"><link rel="prefetch" href="/articles/assets/NTLMç­¾å.html-vx223D2R.js" as="script"><link rel="prefetch" href="/articles/assets/å‘é€NTLMè¯·æ±‚.html-Cqw3Zhqf.js" as="script"><link rel="prefetch" href="/articles/assets/ç›¸å…³æ¼æ´.html-D7ixi6Nr.js" as="script"><link rel="prefetch" href="/articles/assets/IPCè¿æ¥ä¸é»˜è®¤å…±äº«çš„ç›˜ç¬¦æ–‡ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«.html-3VOetEg3.js" as="script"><link rel="prefetch" href="/articles/assets/Potatoå®¶æ—ææƒ.html-DhfQgdpt.js" as="script"><link rel="prefetch" href="/articles/assets/Psexecè¿‡ç¨‹åˆ†æä¸ç›‘æµ‹.html-FSnMDOba.js" as="script"><link rel="prefetch" href="/articles/assets/windowsæƒé™æå‡.html-CMAt1ZkH.js" as="script"><link rel="prefetch" href="/articles/assets/å†…ç½‘ä¿¡æ¯æ”¶é›†.html-BJPG-emp.js" as="script"><link rel="prefetch" href="/articles/assets/å†…ç½‘æƒé™æŒä¹…åŒ–.html-DayL8Gbv.js" as="script"><link rel="prefetch" href="/articles/assets/å†…ç½‘æ¨ªå‘ç§»åŠ¨.html-CrAXpM4c.js" as="script"><link rel="prefetch" href="/articles/assets/å†…ç½‘æ¸—é€åŸºç¡€çŸ¥è¯†.html-n-SWeZk7.js" as="script"><link rel="prefetch" href="/articles/assets/å“ˆå¸Œä¼ é€’æ”»å‡»(PTH).html-Dl6dq95b.js" as="script"><link rel="prefetch" href="/articles/assets/ç«¯å£è½¬å‘ä¸ä»£ç†.html-B7x_COFm.js" as="script"><link rel="prefetch" href="/articles/assets/CSRF.html-SW8WjNql.js" as="script"><link rel="prefetch" href="/articles/assets/JWT.html-CoubRWEl.js" as="script"><link rel="prefetch" href="/articles/assets/Redisæœªæˆæƒæ¼æ´.html-Db5SaDgu.js" as="script"><link rel="prefetch" href="/articles/assets/SQL.html-BURorKVT.js" as="script"><link rel="prefetch" href="/articles/assets/Ssrf.html-CWZ0XFeE.js" as="script"><link rel="prefetch" href="/articles/assets/Upload Insecure Files.html-OEKVSr4H.js" as="script"><link rel="prefetch" href="/articles/assets/XML.html-D81EjJV9.js" as="script"><link rel="prefetch" href="/articles/assets/XSS.html-BywsLibZ.js" as="script"><link rel="prefetch" href="/articles/assets/IP_parsing.html-ChXR7DKl.js" as="script"><link rel="prefetch" href="/articles/assets/åå¼¹shellåŸç†åŠåˆ†æ.html-VxxYGMth.js" as="script"><link rel="prefetch" href="/articles/assets/ç³»ç»Ÿææƒ.html-Dnwq9oYx.js" as="script"><link rel="prefetch" href="/articles/assets/Java_Agent.html--MtoXd4y.js" as="script"><link rel="prefetch" href="/articles/assets/controller.html-YOoG0l9l.js" as="script"><link rel="prefetch" href="/articles/assets/Interceptor.html-BVFrKjZJ.js" as="script"><link rel="prefetch" href="/articles/assets/Adapter.html-5mPE_dIf.js" as="script"><link rel="prefetch" href="/articles/assets/Executor.html-Dw9awOBY.js" as="script"><link rel="prefetch" href="/articles/assets/Filter.html-8ioPDzQ8.js" as="script"><link rel="prefetch" href="/articles/assets/Listener.html-CYtvfuL4.js" as="script"><link rel="prefetch" href="/articles/assets/Servlet.html-oQm3R21R.js" as="script"><link rel="prefetch" href="/articles/assets/Tomcatæ¶æ„.html-B0sLghq3.js" as="script"><link rel="prefetch" href="/articles/assets/Upgrade.html-DoMCg3KM.js" as="script"><link rel="prefetch" href="/articles/assets/Valve.html-DCOpjMG0.js" as="script"><link rel="prefetch" href="/articles/assets/ååºåˆ—åŒ–æ³¨å…¥å†…å­˜é©¬.html-Dp-LsK9a.js" as="script"><link rel="prefetch" href="/articles/assets/BeanFactory.html-DXnkVHCX.js" as="script"><link rel="prefetch" href="/articles/assets/Hex_Base.html-iITwRDnM.js" as="script"><link rel="prefetch" href="/articles/assets/JNDI.html-CKcVi2kl.js" as="script"><link rel="prefetch" href="/articles/assets/URLClassLoader.html-Cz9H6yyf.js" as="script"><link rel="prefetch" href="/articles/assets/CC1.html-7mC5_162.js" as="script"><link rel="prefetch" href="/articles/assets/CC2.html-IFIXtfHE.js" as="script"><link rel="prefetch" href="/articles/assets/CC3.html-DrN-8dox.js" as="script"><link rel="prefetch" href="/articles/assets/CC4.html-ByOohAJX.js" as="script"><link rel="prefetch" href="/articles/assets/CC5.html-EEg6PPsv.js" as="script"><link rel="prefetch" href="/articles/assets/CC6.html-DSvs0P_-.js" as="script"><link rel="prefetch" href="/articles/assets/CC7.html-B1Xjoqea.js" as="script"><link rel="prefetch" href="/articles/assets/Transformer.html-BbVh1LO3.js" as="script"><link rel="prefetch" href="/articles/assets/Mysql.html-BHg-SMS1.js" as="script"><link rel="prefetch" href="/articles/assets/å…¥é—¨å°è¯•ç¯‡.html-NDiS16HB.js" as="script"><link rel="prefetch" href="/articles/assets/åŸºæœ¬ä½¿ç”¨.html-DGH4eqLl.js" as="script"><link rel="prefetch" href="/articles/assets/404.html-Cgf62U0R.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-4j5fwV-g.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DULVbgdv.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-JMmAk-KG.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-CwLVL-C4.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BozBz9zP.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-PDcLWHOa.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-HnbH_qyP.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BSbWn9Xu.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Bw7Eq_XS.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-CDLzLQY2.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-ftI39xYm.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-OsqxZBAb.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-mCyhugr0.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-h5i1SGSo.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-972XI028.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Oj-4OZD3.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-PtXuC15D.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-CzMbZgKK.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-CCqAf6Be.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-hFcmh7VQ.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DJkWSLr7.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BYvqEtJh.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BbfDgHC8.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-C5aovznj.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-B0Wvhw4A.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Bj6Di-tA.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DAHjRtBA.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-eQoNKRDh.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-KUSRtHsB.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BoBMchNc.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Bhj74XaZ.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DNSfl9hN.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BBsv_skI.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Xh08z9Zh.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Bvg1WPTd.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-CfVmIg04.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DItOmTtO.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-Dkh6NMpw.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-CtH95Ffy.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-anzHPGNX.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DUXCKHrX.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-162FtOoG.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-DDfe71zk.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-7iECCkbv.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-tb9HmGpj.js" as="script"><link rel="prefetch" href="/articles/assets/index.html-BdHsakpq.js" as="script"><link rel="prefetch" href="/articles/assets/photoswipe.esm-CMg0yb1C.js" as="script"><link rel="prefetch" href="/articles/assets/setupDevtools-7MC2TMWH-BFND-3Ff.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/articles/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">uu2fu3oçš„çŸ¥è¯†åº“</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/articles/" aria-label="Home"><!--[--><i class="vp-icon fas fa-home" style=""></i><!--]-->Home<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">æ¸—é€æµ‹è¯•</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æŠ€æœ¯åŸç†ä¸åˆ†æ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å†…ç½‘ä½“ç³»å»ºè®¾</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å¤–ç½‘æ¼æ´</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">AD CSä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Exchangeä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Kerberosä¸“é¢˜</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98.html" aria-label="å§”æ´¾æ”»å‡»ä¸“é¢˜"><!---->å§”æ´¾æ”»å‡»ä¸“é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/AS_REQ_AS_REP%E9%98%B6%E6%AE%B5%E6%94%BB%E5%87%BB.html" aria-label="AS_REQ&amp;AS_REPé˜¶æ®µæ”»å‡»"><!---->AS_REQ&amp;AS_REPé˜¶æ®µæ”»å‡»<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/Kerberos%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80.html" aria-label="Kerberosè®¤è¯åŸºç¡€"><!---->Kerberosè®¤è¯åŸºç¡€<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/PAC.html" aria-label="PACä»‹ç»"><!---->PACä»‹ç»<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/Pass-the-ticket.html" aria-label="Pass-the-ticket"><!---->Pass-the-ticket<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/TGS_REQ_TGS_REP%E9%98%B6%E6%AE%B5%E6%94%BB%E5%87%BB.html" aria-label="TGS_REQ&amp;TGS_REPé˜¶æ®µæ”»å‡»"><!---->TGS_REQ&amp;TGS_REPé˜¶æ®µæ”»å‡»<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/TGS_REQ_TGS_REP%E9%98%B6%E6%AE%B5%E8%AF%A6%E8%A7%A3.html" aria-label="TGS_REQ&amp;TGS_REPé˜¶æ®µè¯¦è§£"><!---->TGS_REQ&amp;TGS_REPé˜¶æ®µè¯¦è§£<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">LDAPä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">NTLMä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Javaå­¦ä¹ </span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Reverse</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">äººå·¥æ™ºèƒ½</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å°æŠ€èƒ½</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->TGS_REQ&amp;TGS_REPé˜¶æ®µè¯¦è§£</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">uu2fu3o</a></span><span property="author" content="uu2fu3o"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025å¹´1æœˆ16æ—¥</span><meta property="datePublished" content="2025-01-15T18:41:02.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 12 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT12M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><!--[--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tgs-req">TGS_REQ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tgs-rep">TGS_REP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#s4u">S4U</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#s4u2self">S4U2SELF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#s4u2proxy">S4U2Proxy</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#s4u2proxyç”Ÿæˆçš„ç¥¨æ®æ˜¯å¦å¯è½¬å‘é—®é¢˜">S4U2PROXYç”Ÿæˆçš„ç¥¨æ®æ˜¯å¦å¯è½¬å‘é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“ä¸€ä¸‹s4u">æ€»ç»“ä¸€ä¸‹S4U</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å§”æ´¾">å§”æ´¾</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#éçº¦æŸå§”æ´¾">éçº¦æŸå§”æ´¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#çº¦æŸå§”æ´¾">çº¦æŸå§”æ´¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾">åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--]--><!----></aside></div><!----><div class="theme-hope-content" vp-content><h1 id="tgs-req-tgs-repé˜¶æ®µè¯¦è§£" tabindex="-1"><a class="header-anchor" href="#tgs-req-tgs-repé˜¶æ®µè¯¦è§£"><span>TGS_REQ&amp;TGS_REPé˜¶æ®µè¯¦è§£</span></a></h1><p>è¿™ä¸ªé˜¶æ®µæ‰“ç®—æŠŠå­—æ®µæŒ‘å‡ºæ¥å•ç‹¬ä»‹ç»ä¸€ä¸‹ï¼Œé¡ºä¾¿ä»‹ç»ä»‹ç»å§”æ´¾</p><h2 id="tgs-req" tabindex="-1"><a class="header-anchor" href="#tgs-req"><span>TGS_REQ</span></a></h2><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/1.png" alt="1" tabindex="0" loading="lazy"><figcaption>1</figcaption></figure><p>TGS_REQæ•°æ®åŒ…å¦‚ä¸‹</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Kerberos</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Record</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mark:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1335</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Reserved:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        .000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0101</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0011</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0111</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Record</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1335</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    tgs-req</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        pvno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        msg-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> krb-tgs-req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (12)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        padata:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> item</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            PA-DATA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pA-TGS-REQ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                padata-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pA-TGS-REQ</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    padata-value:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6e8204923082048ea003020105a10302010ea20703050000000000a38204096182040530â€¦</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                        ap-req</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                            pvno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                            msg-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> krb-ap-req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (14)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                            Padding:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                            ap-options:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 00000000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reserved:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use-session-key:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                                .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mutual-required:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                            ticket</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                tkt-vno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                realm:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HACK.COM</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                sname</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                    name-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kRB5-NT-SRV-INST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                    sname-string:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> items</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                        SNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> krbtgt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                        SNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hack.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                enc-part</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                    etype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eTYPE-AES256-CTS-HMAC-SHA1-96</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (18)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                    kvno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                    cipher:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 41590d9624a82c3a7f3adc91125074691bef1fd2c835edf2542758d2527a716883128737â€¦</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                            authenticator</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                etype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eTYPE-ARCFOUR-HMAC-MD5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (23)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                cipher:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 864f8ffbfdb0d3d28609a8f7f406883dd170da239cf2432462e129c294d6b711cc561953â€¦</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        req-body</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Padding:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            kdc-options:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 00000000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reserved:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> forwardable:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> forwarded:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proxiable:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proxy:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> allow-postdate:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> postdated:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ...0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused7:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> renewable:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused9:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused10:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opt-hardware-auth:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused12:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused13:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> constrained-delegation:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ...0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> canonicalize:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request-anonymous:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused17:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused18:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused19:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused20:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused21:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused22:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ...0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused23:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused24:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused25:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> disable-transited-check:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> renewable-ok:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enc-tkt-in-skey:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .0..</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unused29:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..0.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> renew:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ...0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> validate:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> False</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            cname</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                name-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kRB5-NT-PRINCIPAL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                cname-string:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> item</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    CNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Administrator</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            realm:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hack.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            sname</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                name-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kRB5-NT-SRV-INST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                sname-string:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> items</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    SNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> krbtgt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    SNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hack.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            till:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Sep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 13,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2037</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:48:05.000000000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ä¸­å›½æ ‡å‡†æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            nonce:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1818848256</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            etype:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> item</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                ENCTYPE:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eTYPE-ARCFOUR-HMAC-MD5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (23)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="msg-type" tabindex="-1"><a class="header-anchor" href="#msg-type"><span>msg-type</span></a></h4><p>TGS_REQå¯¹åº”çš„å°±æ˜¯KRB_TGS_REQ(0x0c)</p><h4 id="pa-data" tabindex="-1"><a class="header-anchor" href="#pa-data"><span>PA-DATA</span></a></h4><ul><li><p>AP_REQ</p><p>è¯¥ç»“æ„ä½“ä¸­å­˜æ”¾ç€AS_REPè·å–åˆ°çš„TGTç¥¨æ®,KDCä¼šæ ¡éªŒä»–æ¥è¿”å›TGSç¥¨æ®</p></li><li><p>PA_FOR_USER</p><p>(æ²¡æœ‰è¯¥æ‰©å±•åˆ™æ²¡æœ‰è¯¥å­—æ®µ)</p><p>ç±»å‹æ˜¯S4U2SELF</p><p>å€¼æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦æŒ‡ç¤ºç”¨æˆ·çš„èº«ä»½ è¯¥å”¯ä¸€æ ‡è¯†ç¬¦ç”±ç”¨æˆ·åå’ŒåŸŸåç»„æˆ</p><p>S4U2proxy å¿…é¡»æ‰©å±•PA_FOR_USERç»“æ„ï¼ŒæŒ‡å®šæœåŠ¡ä»£è¡¨æŸä¸ªç”¨æˆ·(å›¾ç‰‡é‡Œé¢æ˜¯administrator)å»è¯·æ±‚é’ˆå¯¹æœåŠ¡è‡ªèº«çš„kerberosæœåŠ¡ç¥¨æ®</p></li><li><p>PA_PAC_OPTIONS</p><p>å€¼æ˜¯ä»¥ä¸‹flagçš„ç»„åˆ</p><p>-- Claims(0)</p><p>-- Branch Aware(1)</p><p>-- Forward to Full DC(2)</p><p>-- Resource-based Constrained Delegation (3)</p><p>å¾®è½¯çš„<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/aeecfd82-a5e4-474c-92ab-8df9022cf955" target="_blank" rel="noopener noreferrer">MS-SFU 2.2.5</a>ï¼Œ ä½¿ç”¨åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼ŒS4U2proxy åº”è¯¥ æ‰©å±• PA-PAC-OPTIONS ç»“æ„</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> PA-PAC-OPTIONS ::= KerberosFlags </span></span>
<span class="line"><span>   -- resource-based constrained delegation (3)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‡å®šResource-based Constrained Delegation (3)ä½</p></li></ul><h4 id="req-body" tabindex="-1"><a class="header-anchor" href="#req-body"><span>REQ-BODY</span></a></h4><ul><li><p>sname</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>            sname</span></span>
<span class="line"><span>                name-type: kRB5-NT-SRV-INST (2)</span></span>
<span class="line"><span>                sname-string: 2 items</span></span>
<span class="line"><span>                    SNameString: krbtgt</span></span>
<span class="line"><span>                    SNameString: hack.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ±‚çš„æœåŠ¡åç§°ï¼ŒTGSç¥¨æ®æ˜¯ä½¿ç”¨è¯¥æœåŠ¡ç”¨æˆ·çš„ntlm-hashè¿›è¡ŒåŠ å¯†çš„ã€‚å¦‚æœè¯·æ±‚çš„æœåŠ¡æ˜¯krbtgtï¼Œé‚£ä¹ˆæ‹¿åˆ°çš„TGSå¯ä»¥å½“ä½œTGTä½¿ç”¨</p></li><li><p>AdditonTicket</p><p>é™„åŠ ç¥¨æ®ï¼Œåœ¨S4U2proxyè¯·æ±‚é‡Œé¢ï¼Œæ—¢éœ€è¦æ­£å¸¸çš„TGTï¼Œä¹Ÿéœ€è¦S4U2selfé˜¶æ®µè·å–åˆ°çš„TGSï¼Œé‚£ä¹ˆè¿™ä¸ªTGSå°±æ·»åŠ åˆ°AddtionTicketé‡Œé¢ã€‚</p></li></ul><h2 id="tgs-rep" tabindex="-1"><a class="header-anchor" href="#tgs-rep"><span>TGS_REP</span></a></h2><p>æ•°æ®åŒ…å¦‚ä¸‹</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Kerberos</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Record</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mark:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1322</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        0...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ....</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Reserved:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        .000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0101</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0010</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1010</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Record</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1322</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    tgs-rep</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        pvno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        msg-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> krb-tgs-rep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (13)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        crealm:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HACK.COM</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        cname</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            name-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kRB5-NT-PRINCIPAL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            cname-string:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> item</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                CNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Administrator</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ticket</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            tkt-vno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            realm:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HACK.COM</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            sname</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                name-type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kRB5-NT-SRV-INST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                sname-string:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> items</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    SNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> krbtgt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                    SNameString:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hack.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            enc-part</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                etype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eTYPE-ARCFOUR-HMAC-MD5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (23)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                kvno:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                cipher:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5f794a8a8a3035ecfd4269c30b0dc26908dd06d39db80434f39252f3502c553ef3e525dcâ€¦</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        enc-part</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            etype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eTYPE-ARCFOUR-HMAC-MD5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (23)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            cipher:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dd63c996246084df190c9e6bbf542d82f06930524922b943d30fcdbc92df84c8a57cba74â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="msg-type-1" tabindex="-1"><a class="header-anchor" href="#msg-type-1"><span>msg_type</span></a></h4><p>AS_REQçš„å“åº”bodyå¯¹åº”çš„å°±æ˜¯KRB_TGS_REQ(0x0d)</p><h4 id="ticket" tabindex="-1"><a class="header-anchor" href="#ticket"><span>ticket</span></a></h4><p>è¿”å›çš„TGSç¥¨æ®ï¼Œä½¿ç”¨ç”¨æˆ·ç”³è¯·çš„å¯¹åº”æœåŠ¡çš„ntlmhashåŠ å¯†,ç”¨æˆ·æ— æ³•è¯»å–å…¶ä¸­çš„å†…å®¹ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰æœåŠ¡çš„hashï¼Œæˆ‘ä»¬å°±èƒ½è‡ªå·±åˆ¶ä½œä¸€ä¸ªticket.è¿™é‡Œä¼šäº§ç”Ÿä¸¤ä¸ªå®‰å…¨é—®é¢˜ï¼Œä¸€æ˜¯ç™½é“¶ç¥¨æ®ï¼Œè€Œæ˜¯kerberostingï¼Œå³hashçš„ç ´è§£</p><h4 id="enc-part" tabindex="-1"><a class="header-anchor" href="#enc-part"><span>enc_part</span></a></h4><p>å¹¶ä¸æ˜¯ticketå†…çš„enc_partï¼Œè¿™ä¸€éƒ¨ç”¨æˆ·å¯ä»¥è§£å¯†ï¼Œå¯¹åº”çš„session_keyåœ¨AS_REPé˜¶æ®µå°±ä¼ ç»™äº†ç”¨æˆ·ï¼Œè€Œè¿™ä¸€éƒ¨åˆ†å†…å®¹é‡Œé¢åŒ…å«äº†æ–°çš„session_keyç­‰ä¿¡æ¯ï¼Œæ–°çš„session_keyç”¨æ¥ä½œä¸ºä¸‹ä¸€é˜¶æ®µçš„è®¤è¯å¯†é’¥</p><h2 id="s4u" tabindex="-1"><a class="header-anchor" href="#s4u"><span>S4U</span></a></h2><h3 id="s4u2self" tabindex="-1"><a class="header-anchor" href="#s4u2self"><span>S4U2SELF</span></a></h3><p>æ ¹æ®å¾®è½¯å®˜æ–¹çš„ä»‹ç»</p><p>S4U2self æ‰©å±•å…è®¸æœåŠ¡ä»£è¡¨ç”¨æˆ·è·å–è‡ªèº«çš„æœåŠ¡ç¥¨è¯ã€‚ä½¿ç”¨ç”¨æˆ·çš„åç§°å’ŒåŸŸåå‘ KDC æ ‡è¯†ç”¨æˆ·ã€‚æˆ–è€…ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„è¯ä¹¦æ ‡è¯†ç”¨æˆ·ã€‚Kerberos ç¥¨è¯æˆäºˆæœåŠ¡ ï¼ˆTGSï¼‰ äº¤æ¢è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ï¼ˆKRB_TGS_REQå’ŒKRB_TGS_REPï¼‰ä¸ä¸¤ç§æ–°æ•°æ®ç»“æ„ä¹‹ä¸€ä¸€èµ·ä½¿ç”¨ã€‚å½“é€šè¿‡ç”¨æˆ·åå’Œé¢†åŸŸåç§°å‘ KDC æ ‡è¯†ç”¨æˆ·æ—¶ï¼Œå°†ä½¿ç”¨æ–°çš„ PA-FOR-USER æ•°æ®ç»“æ„ã€‚å¦ä¸€ç§ç»“æ„ PA-S4U-X509-USER åœ¨å‘ KDC æä¾›ç”¨æˆ·è¯ä¹¦ä»¥è·å–æˆæƒä¿¡æ¯æ—¶ä½¿ç”¨ã€‚é€šè¿‡ä»£è¡¨ç”¨æˆ·è·å–è‡ªèº«çš„æœåŠ¡ç¥¨è¯ï¼ŒæœåŠ¡åœ¨ç¥¨è¯ä¸­æ¥æ”¶ç”¨æˆ·çš„æˆæƒæ•°æ®ã€‚</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/s4u2self.png" alt="s4u2self" tabindex="0" loading="lazy"><figcaption>s4u2self</figcaption></figure><blockquote><p>ç”¨æˆ·ä¼šé€šè¿‡å…¶ä»–åè®®ï¼ˆä¾‹å¦‚NTLMæˆ–åŸºäºè¡¨å•çš„èº«ä»½éªŒè¯ï¼‰å¯¹æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå› æ­¤ä»–ä»¬ä¸ä¼šå°†TGSå‘é€ç»™æœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å¯ä»¥è°ƒç”¨<code>S4U2Self</code>æ¥è¦æ±‚èº«ä»½éªŒè¯æœåŠ¡ä¸ºå…¶è‡ªèº«çš„ä»»æ„ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªTGSï¼Œç„¶åå¯ä»¥åœ¨è°ƒç”¨S4U2Proxyæ—¶å°†å…¶ç”¨ä½œå‡­è¯</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯: <strong>æœåŠ¡ä»£è¡¨ç”¨æˆ·è·å¾—é’ˆå¯¹æœåŠ¡è‡ªèº«çš„kerberosç¥¨æ®è¿™ä¸ªè¿‡ç¨‹ï¼ŒæœåŠ¡æ˜¯ä¸éœ€è¦ç”¨æˆ·çš„å‡­æ®çš„</strong></p><p><strong>æ¡ä»¶</strong></p><ul><li><p>TGTå¯è½¬å‘</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/TGTfoward.png" alt="TGTfoward" tabindex="0" loading="lazy"><figcaption>TGTfoward</figcaption></figure></li><li><p>æœåŠ¡é…ç½®äº†çº¦æŸå§”æ´¾</p></li><li><p>æœåŠ¡è¯·æ±‚äº†å¯è½¬å‘é€‰é¡¹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/forwardoption.png" alt="forwardoption" tabindex="0" loading="lazy"><figcaption>forwardoption</figcaption></figure></li></ul><p>åˆ™TGSå¿…é¡»å°†<strong>ç¥¨è¯æ ‡å¿—</strong> å­—æ®µè®¾ç½®ä¸ºå¯è½¬å‘ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç”¨æˆ·çš„UserAccountControlå­—æ®µä¸­è®¾ç½®äº†USER_NOT_DELEGATEDä½,é‚£ä¹ˆè¿”å›çš„TGSæ˜¯æ°¸è¿œä¹Ÿæ²¡æ³•è½¬å‘çš„ã€‚</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/2.png" alt="2" tabindex="0" loading="lazy"><figcaption>2</figcaption></figure><p>ä¹Ÿå°±æ˜¯ä¸Šå›¾çš„æ•æ„Ÿè´¦æˆ·ä¸èƒ½è¢«å§”æ´¾ï¼Œéœ€è¦å…³é—­ã€‚</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/s4u2self2.png" alt="s4u2self2" tabindex="0" loading="lazy"><figcaption>s4u2self2</figcaption></figure><p>å¦‚ä¸Šå›¾S4U2SELFçš„è¯·æ±‚è¿‡ç¨‹ï¼ŒæœåŠ¡ä»£æ›¿ç”¨æˆ·å»è¯·æ±‚æœåŠ¡ï¼Œäº‹å®ä¸Šä»KDCè¯·æ±‚TGSç¥¨æ®å›æ¥(éœ€è¦æœ‰æœåŠ¡ç”¨æˆ·å‘KDCè¯·æ±‚çš„TGTç¥¨æ®)ï¼Œè¿™ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆS4U2SELFè¿™ä¸ªè¯·æ±‚è¿‡ç¨‹æ˜¯ä¸éœ€è¦ç”¨æˆ·å‡­æ®çš„ã€‚</p><p>é€šè¿‡TGS_REQå’ŒTGS_REQçš„æµé‡å¯ä»¥çœ‹å‡ºï¼ŒTGS_REQç”±hackerå‘hackerè¿™ä¸ªæœåŠ¡è¿›è¡Œç”³è¯·ï¼Œåˆ°KDCåï¼Œé€šè¿‡S4U2SELFä»£æ›¿administratorè¯·æ±‚ä¸€ä¸ªå¯¹åº”æœåŠ¡çš„TGSç¥¨æ®</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/s4u2self3.png" alt="s4u2self3" tabindex="0" loading="lazy"><figcaption>s4u2self3</figcaption></figure><h3 id="s4u2proxy" tabindex="-1"><a class="header-anchor" href="#s4u2proxy"><span>S4U2Proxy</span></a></h3><p>ç”¨æˆ·åˆ°ä»£ç†æœåŠ¡ ï¼ˆS4U2proxyï¼‰ æ‰©å±•æä¾›ä»£è¡¨ç”¨æˆ·è·å–å¦ä¸€ä¸ªæœåŠ¡çš„æœåŠ¡ç¥¨è¯çš„æœåŠ¡ã€‚æ­¤åŠŸèƒ½ç§°ä¸ºçº¦æŸå§”æ´¾ã€‚Kerberos ç¥¨è¯æˆäºˆæœåŠ¡ ï¼ˆTGSï¼‰ äº¤æ¢è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ï¼ˆKRB_TGS_REQå’ŒKRB_TGS_REPï¼‰ä¸æ–°çš„ CNAME-IN-ADDL-TKT å’ŒS4U_DELEGATION_INFOæ•°æ®ç»“æ„ä¸€èµ·ä½¿ç”¨ã€‚ç¬¬äºŒä¸ªæœåŠ¡é€šå¸¸æ˜¯ä»£è¡¨ç¬¬ä¸€ä¸ªæœåŠ¡æ‰§è¡ŒæŸäº›å·¥ä½œçš„ä»£ç†ï¼Œå¹¶ä¸”ä»£ç†åœ¨ç”¨æˆ·çš„æˆæƒä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œè¯¥å·¥ä½œã€‚</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/S4U2Proxy.png" alt="S4U2Proxy" tabindex="0" loading="lazy"><figcaption>S4U2Proxy</figcaption></figure><p>åœ¨(1)ä¸­ï¼ŒæœåŠ¡1å‘KDCè·å–å¯è½¬å‘çš„TGSç¥¨æ®ï¼Œå¹¶å°†è¿”å›çš„æœåŠ¡ç¥¨è¯ä½œä¸ºä¸‹ä¸€æ­¥è¯·æ±‚ä¸­çš„AddtionTicketï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ul><li><p>æ‹¥æœ‰æ¥åœ¨ç”¨æˆ·çš„æˆæƒ(S4U2SELEé˜¶æ®µè·å¾—çš„ç¥¨æ®)ï¼Œå°†å…¶å¡«å…¥AddtionTicket.</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/addtionticket.png" alt="addtionticket" tabindex="0" loading="lazy"><figcaption>addtionticket</figcaption></figure></li><li><p>åœ¨è¯·æ±‚çš„kdc-optionsä¸­è®¾ç½®äº†CNAME-IN-ADDL-TKTæ ‡å¿—</p></li><li><p>æœåŠ¡è¯·æ±‚äº†å¯è½¬å‘é€‰é¡¹</p></li><li><p>æœåŠ¡1 æœ‰åˆ°æœåŠ¡2çš„çº¦æŸå§”æ´¾ï¼Œå°†æœåŠ¡2çš„SPNæ”¾åœ¨snameé‡Œé¢</p></li></ul><p>æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå°†ä¼šè¿”å›æœåŠ¡ç¥¨è¯ã€‚å¯è½¬å‘æ ‡å¿—å°†åœ¨æœåŠ¡ç¥¨è¯ä¸­è®¾ç½®</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/s4u2proxy2.png" alt="s4u2proxy2" tabindex="0" loading="lazy"><figcaption>s4u2proxy2</figcaption></figure><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œhacker--&gt; cifs/DC <a href="mailto:administrator@hack.com" target="_blank" rel="noopener noreferrer">administrator@hack.com</a> --&gt; cifs/DC.ticket è¯¥è¿‡ç¨‹åœ¨KDCå®Œæˆ</p><h3 id="s4u2proxyç”Ÿæˆçš„ç¥¨æ®æ˜¯å¦å¯è½¬å‘é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#s4u2proxyç”Ÿæˆçš„ç¥¨æ®æ˜¯å¦å¯è½¬å‘é—®é¢˜"><span>S4U2PROXYç”Ÿæˆçš„ç¥¨æ®æ˜¯å¦å¯è½¬å‘é—®é¢˜</span></a></h3><p>å…³äºè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡AddtionTicketä¸­çš„ç¥¨æ®æ˜¯å¦èƒ½å¤Ÿè½¬å‘æ¥åˆ†æ</p><ul><li><p>AddtionTicketä¸­çš„ç¥¨æ®å¯è½¬å‘</p><p>å¦‚æœAddtionTicketé‡Œé¢çš„ç¥¨æ®æ˜¯å¯è½¬å‘çš„ï¼Œåªè¦KDC Optionsé‡Œé¢ç½®forwarableä½ï¼Œé‚£ä¹ˆè¿”å›çš„ç¥¨æ®å¿…é¡»ç½®ä¸ºå¯è½¬å‘çš„</p><p>ä¾‹å­å’Œä¸Šæ–‡çš„ç›¸åŒï¼Œä¸å†è´´å›¾</p></li><li><p>AddtionTicketä¸­çš„ç¥¨æ®ä¸å¯è½¬å‘</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/noforwardtgs.png" alt="noforwardtgs" tabindex="0" loading="lazy"><figcaption>noforwardtgs</figcaption></figure></li></ul><p>å¦‚å›¾æ‰€ç¤ºç”Ÿæˆçš„ä¸å¯è½¬å‘TGSï¼Œå°†å…¶å¯¼å‡ºç”¨äºä¸‹ä¸€æ­¥ã€‚</p><p>å¦‚æœAddtionTicketä¸­çš„æœåŠ¡ç¥¨æ®æœªè®¾ç½®ä¸ºå¯è½¬å‘çš„ï¼Œåˆ™KDCå¿…é¡»è¿”å›çŠ¶æ€ä¸ºSTATUS_NO_MATCHçš„KRB-ERR-BADOPTIONï¼ˆerror-code 13ï¼‰é€‰é¡¹ã€‚é™¤äº†ä¸€ç§æƒ…å†µä¹‹å¤–ï¼Œå°±æ˜¯é…ç½®äº†æœåŠ¡1åˆ°æœåŠ¡2 çš„åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œä¸”PA-PAC-OPTIONè®¾ç½®äº†Resource-Based Constrained Delegationæ ‡å¿—ä½(è¿™ä¸€ä¾‹å¤–çš„å‰ææ˜¯S4U2SELFé˜¶æ®µæ¨¡æ‹Ÿçš„ç”¨æˆ·æ²¡è¢«è®¾ç½®ä¸ºå¯¹å§”æ´¾æ•æ„Ÿï¼Œå¯¹å§”æ´¾æ•æ„Ÿçš„åˆ¤æ–­åœ¨S4U2SELFé˜¶æ®µï¼Œè€Œä¸æ˜¯S4U2PROXYé˜¶æ®µ)ã€‚</p><blockquote><p>é€šè¿‡powerviewæˆ–ActiveDirectoryæ¨¡å—æ¥ä¿®æ”¹msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§é…ç½®åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Set-ADComputer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -PrincipalsAllowedToDelegateToAccount</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hacker</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Get-ADComputer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Properties</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PrincipalsAllowedToDelegateToAccount</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/ziyuanweipai1.png" alt="ziyuanweipai1" tabindex="0" loading="lazy"><figcaption>ziyuanweipai1</figcaption></figure><blockquote><p>PA-PAC-OPTIONè®¾ç½®äº†Resource-Based Constrained Delegationæ ‡å¿—ä½</p></blockquote><p>æ­¤æ—¶å‘åŒ…ï¼Œå¾—åˆ°çš„ç¥¨æ®æ˜¯å¯è½¬å‘çš„</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/kezhuanfa.png" alt="kezhuanfa" tabindex="0" loading="lazy"><figcaption>kezhuanfa</figcaption></figure><h3 id="æ€»ç»“ä¸€ä¸‹s4u" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“ä¸€ä¸‹s4u"><span>æ€»ç»“ä¸€ä¸‹S4U</span></a></h3><p>s4u2selfåƒä¸€ä¸ªä»£ç†åè®®ï¼Œä¸éœ€è¦ç”¨æˆ·å‡­è¯å°±èƒ½æ‹¿åˆ°è‡ªèº«æœåŠ¡çš„TGSï¼Œä½†æ˜¯éœ€è¦æœåŠ¡è´¦æˆ·ã€‚s4u2proxyåˆ™æ˜¯ä»¥service1å‘KDCè¯·æ±‚service2çš„TGSç¥¨æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šåˆ¤æ–­msDS-AllowedToDelegateToçš„SPNæ¥ç¡®å®šæ˜¯å¦å¯ä»¥ç”³è¯·åˆ°service2çš„TGS,åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åˆ™æ˜¯çœ‹msDS-AllowedToActOnBehalfOfOtherIdentityã€‚</p><p>å¯ç»“åˆä¸‹å›¾çœ‹æ•´ä¸ªæµç¨‹ï¼Œæ–¹ä¾¿ç†è§£</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/s4u.png" alt="s4u" tabindex="0" loading="lazy"><figcaption>s4u</figcaption></figure><h2 id="å§”æ´¾" tabindex="-1"><a class="header-anchor" href="#å§”æ´¾"><span>å§”æ´¾</span></a></h2><p>åœ¨Windows 2000 Serveré¦–æ¬¡å‘å¸ƒActive Directoryæ—¶ï¼ŒMicrosoftå¿…é¡»æä¾›ä¸€ç§ç®€å•çš„æœºåˆ¶æ¥æ”¯æŒç”¨æˆ·é€šè¿‡Kerberoså‘Web Serverè¿›è¡Œèº«ä»½éªŒè¯å¹¶éœ€è¦ä»£è¡¨è¯¥ç”¨æˆ·æ›´æ–°åç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„è®°å½•çš„æ–¹æ¡ˆã€‚è¿™é€šå¸¸ç§°ä¸ºâ€œ KerberosåŒè·³é—®é¢˜â€ï¼Œå¹¶ä¸”è¦æ±‚è¿›è¡Œå§”æ´¾ï¼Œä»¥ä¾¿Web Serveråœ¨ä¿®æ”¹æ•°æ®åº“è®°å½•æ—¶æ¨¡æ‹Ÿç”¨æˆ·ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯æ¥å—å§”æ´¾çš„ç”¨æˆ·åªèƒ½æ˜¯<strong>æœåŠ¡è´¦æˆ·</strong>æˆ–è€…<strong>è®¡ç®—æœºç”¨æˆ·</strong>ã€‚</p><h3 id="éçº¦æŸå§”æ´¾" tabindex="-1"><a class="header-anchor" href="#éçº¦æŸå§”æ´¾"><span>éçº¦æŸå§”æ´¾</span></a></h3><p>éçº¦æŸå§”æ´¾é…ç½®å¦‚ä¸‹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/feiyueshuweipai.png" alt="feiyueshuweipai" tabindex="0" loading="lazy"><figcaption>feiyueshuweipai</figcaption></figure><p>å¦‚æœæœåŠ¡hackeré…ç½®äº†éçº¦æŸçš„å§”æ´¾ï¼Œé‚£hackerå°±å¯æ¥å—ä»»ä½•ç”¨æˆ·çš„å§”æ´¾å»è¯·æ±‚å…¶ä»–æœåŠ¡ã€‚åè®®å±‚æ¥è®²ï¼ŒæœåŠ¡hackerè·å–åˆ°ç”¨æˆ·çš„å¯è½¬å‘TGTç¥¨æ®(TGSç¥¨æ®å†…)ï¼Œè¿™ä¸€æ­¥æ˜¯é€šè¿‡AP_REQæ¥å®Œæˆçš„ã€‚å¹¶å°†å…¶ç¼“å­˜åˆ°lsassè¿›ç¨‹å½“ä¸­ï¼Œæ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚æœåŠ¡hackeré€šè¿‡è·å–åˆ°ç¥¨æ®å—ç”¨æˆ·å§”æ´¾æ¨¡æ‹Ÿç”¨æˆ·å»è®¿é—®service2.</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/image001.png" alt="image001" tabindex="0" loading="lazy"><figcaption>image001</figcaption></figure><p>å¦‚å›¾ï¼Œæ¥ä¸‹æ¥é€šè¿‡jackson -&gt; hacker -&gt; cifs/PC æ¥æ¨¡æ‹Ÿå®Œæ•´æµç¨‹ï¼Œå¦‚ä¸‹å›¾</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/éçº¦æŸå§”æ´¾.png" alt="éçº¦æŸå§”æ´¾" tabindex="0" loading="lazy"><figcaption>éçº¦æŸå§”æ´¾</figcaption></figure><p>ä¸‰ä¸ªè¯·æ±‚åˆ†åˆ«å¯¹åº”äº†jacksonè¯·æ±‚TGTï¼Œjacksonè¯·æ±‚hackeræœåŠ¡çš„TGSï¼ŒhackeræœåŠ¡è¢«å§”æ´¾è¯·æ±‚cifs/PCæœåŠ¡</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/éçº¦æŸå§”æ´¾2.png" alt="éçº¦æŸå§”æ´¾2" tabindex="0" loading="lazy"><figcaption>éçº¦æŸå§”æ´¾2</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼Œhackerå‘cifs/PCè¯·æ±‚æœåŠ¡ï¼Œè¿”å›jacksonå¯¹cifs/PCçš„TGSç¥¨æ®ï¼ŒhackeræˆåŠŸæ¨¡æ‹Ÿç”¨æˆ·ç”³è¯·åˆ°äº†ç¥¨æ®ã€‚ï¼ˆå·¦ä¸ºTGS_REQï¼‰</p><p>é…ç½®äº†éçº¦æŸå§”æ´¾çš„ç”¨æˆ·çš„userAccountControl å±æ€§æœ‰ä¸ªFLAGä½ TrustedForDelegationã€‚</p><h3 id="çº¦æŸå§”æ´¾" tabindex="-1"><a class="header-anchor" href="#çº¦æŸå§”æ´¾"><span>çº¦æŸå§”æ´¾</span></a></h3><p>å…¶å®çº¦æŸå§”æ´¾åœ¨ä¸Šæ–‡çš„S4U2PROXYä¸­å°±å·²ç»æåˆ°è¿‡ï¼Œs4u2selfå’Œs4u2proxyæ˜¯kerberosåè®®ä¸­çš„ä¸€ç»„æ‰©å±•ï¼Œè¢«ç”¨åœ¨çº¦æŸå§”æ´¾å½“ä¸­ã€‚ä¸ºæœåŠ¡é…ç½®çº¦æŸå§”æ´¾åï¼Œçº¦æŸå§”æ´¾å°†é™åˆ¶æŒ‡å®šæœåŠ¡å™¨å¯ä»¥ä»£è¡¨ç”¨æˆ·æ‰§è¡Œçš„æœåŠ¡ã€‚è¿™éœ€è¦åŸŸç®¡ç†å‘˜ç‰¹æƒ(å…¶å®ä¸¥è°¨ä¸€ç‚¹æ˜¯SeEnableDelegationç‰¹æƒï¼Œè¯¥ç‰¹æƒå¾ˆæ•æ„Ÿï¼Œé€šå¸¸ä»…æˆäºˆåŸŸç®¡ç†å‘˜)æ‰èƒ½ä¸ºæœåŠ¡é…ç½®åŸŸå¸æˆ·ï¼Œå¹¶ä¸”å°†å¸æˆ·é™åˆ¶ä¸ºå•ä¸ªåŸŸã€‚</p><p>é…ç½®äº†çº¦æŸå§”æ´¾çš„ç”¨æˆ·å¦‚ä¸‹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/hacker.png" alt="hacker" tabindex="0" loading="lazy"><figcaption>hacker</figcaption></figure><p>è®¾ç½®äº†çº¦æŸå§”æ´¾çš„hackeræœåŠ¡ï¼Œå¯ä»¥æ¥æ‰‹ä»»ä½•ç”¨æˆ·çš„å§”æ´¾å»è¯·æ±‚ç‰¹å®šçš„æœåŠ¡ï¼Œä¾‹å¦‚cifs/PC.å…·ä½“è¿‡ç¨‹æ˜¯æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚ä¹‹åï¼Œé¦–å…ˆä»£è¡¨ç”¨æˆ·è·å¾—é’ˆå¯¹æœåŠ¡è‡ªèº«çš„å¯è½¬å‘çš„kerberosæœåŠ¡ç¥¨æ®(S4U2SELF)ï¼Œæ‹¿ç€è¿™ä¸ªç¥¨æ®å‘KDCè¯·æ±‚è®¿é—®ç‰¹å®šæœåŠ¡çš„å¯è½¬å‘çš„TGS(S4U2PROXY)ï¼Œå¹¶ä¸”ä»£è¡¨ç”¨æˆ·è®¿é—®ç‰¹å®šæœåŠ¡ï¼Œè€Œä¸”åªèƒ½è®¿é—®è¯¥ç‰¹å®šæœåŠ¡ã€‚</p><p>ç›¸è¾ƒäºéçº¦æŸå§”æ´¾ï¼Œçº¦æŸå§”æ´¾æœ€å¤§çš„åŒºåˆ«ä¹Ÿå°±æ˜¯é…ç½®çš„æ—¶å€™é€‰æ‹©æŸä¸ªç‰¹å®šçš„æœåŠ¡ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æœåŠ¡ã€‚</p><p>é…ç½®äº†çº¦æŸå§”æ´¾çš„ç”¨æˆ·çš„userAccountControl å±æ€§æœ‰ä¸ªFLAGä½ TrustedToAuthForDelegation ã€‚çº¦æŸçš„èµ„æºå§”æ´¾ï¼Œé™¤äº†é…ç½®TRUSTED_TO_AUTH_FOR_DELEGATION ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸ªåœ°æ–¹æ˜¯å­˜å‚¨å¯¹å“ªä¸ªspn è¿›è¡Œå§”æ´¾çš„ï¼Œä½äºmsDS-AllowedToDelegateTo</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/useraccount.png" alt="useraccount" tabindex="0" loading="lazy"><figcaption>useraccount</figcaption></figure><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/msds&#39;.png" alt="msds&#39;" tabindex="0" loading="lazy"><figcaption>msds&#39;</figcaption></figure><p>è¿˜æ˜¯æŠ“ä¸€ä¸ªè¯¦ç»†æµç¨‹æ¥çœ‹çœ‹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/çº¦æŸå§”æ´¾æµç¨‹.png" alt="çº¦æŸå§”æ´¾æµç¨‹" tabindex="0" loading="lazy"><figcaption>çº¦æŸå§”æ´¾æµç¨‹</figcaption></figure><p>å¦‚å›¾æ‰€ç¤ºçš„ä¸‰ä¸ªæµç¨‹åˆ†åˆ«å¯¹åº”</p><ul><li>æœåŠ¡hackerå‘KDCè¯·æ±‚è‡ªèº«çš„TGTç¥¨æ®ï¼ˆå¯è½¬å‘ï¼‰</li><li>æœåŠ¡hackeré€šè¿‡s4u2selfæ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚è‡ªèº«çš„TGSç¥¨æ®ï¼ˆå¯è½¬å‘ï¼‰</li><li>æœåŠ¡hackerå—ç”¨æˆ·å§”æ´¾æ¨¡æ‹Ÿç”¨æˆ·ï¼Œé€šè¿‡s4u2proxyè¯·æ±‚æœåŠ¡cifs/PC</li></ul><h3 id="åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾" tabindex="-1"><a class="header-anchor" href="#åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾"><span>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</span></a></h3><p>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åªèƒ½åœ¨è¿è¡ŒWindows Server 2012 R2å’ŒWindows Server 2012çš„åŸŸæ§åˆ¶å™¨ä¸Šé…ç½®ï¼Œä½†å¯ä»¥åœ¨æ··åˆæ¨¡å¼æ—ä¸­åº”ç”¨ã€‚</p><p>è¿™ç§çº¦æŸå§”æ´¾çš„é£æ ¼ä¸ä¼ ç»Ÿçº¦æŸå§”æ´¾éå¸¸ç›¸ä¼¼ï¼Œä½†é…ç½®ç›¸åã€‚ä»å¸æˆ·Aåˆ°å¸æˆ·Bçš„ä¼ ç»Ÿçº¦æŸå§”æ´¾åœ¨msDS-AllowedToDelegateToå±æ€§ä¸­çš„å¸æˆ·Aä¸Šé…ç½®ï¼Œå¹¶å®šä¹‰ä»Aåˆ°Bçš„â€œä¼ å‡ºâ€ä¿¡ä»»ï¼Œè€Œåœ¨msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§ä¸­çš„å¸æˆ·Bä¸Šé…ç½®åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œå¹¶å®šä¹‰ä»Aåˆ°Bçš„â€œä¼ å…¥â€ä¿¡ä»»ï¼Œè§ä¸‹å›¾ã€‚</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/t01fe78dcd0b3af3aa4.jpg" alt="t01fe78dcd0b3af3aa4" tabindex="0" loading="lazy"><figcaption>t01fe78dcd0b3af3aa4</figcaption></figure><p>éœ€è¦serviceAé…ç½®å¦‚ä¸‹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/as/service1.png" alt="service1" tabindex="0" loading="lazy"><figcaption>service1</figcaption></figure><p>serviceBå¦‚ä¸‹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/serviceB.png" alt="serviceB" tabindex="0" loading="lazy"><figcaption>serviceB</figcaption></figure><p>éœ€è¦é…ç½®serviceBæŒ‡å‘Açš„èµ„æºå§”æ´¾,å·²åœ¨ä¸Šæ–‡ä¸­æåˆ°ï¼Œä¸å†èµ˜è¿°</p><p>ç°æŠ“åŒ…åˆ†ææµç¨‹</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾.png" alt="åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾" tabindex="0" loading="lazy"><figcaption>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾</figcaption></figure><p>å¦‚å›¾æ‰€ç¤ºçš„ä¸‰ä¸ªæµç¨‹ï¼Œåˆ†åˆ«å¯¹åº”</p><ul><li><p>æœåŠ¡hacker(serviceA)å‘KDCè¯·æ±‚è‡ªèº«çš„TGTç¥¨æ® (å¯è½¬å‘)</p></li><li><p>æœåŠ¡hackerå‘KDCè¯·æ±‚è‡ªèº«çš„TGSç¥¨æ®</p><p>ç”±äºæœåŠ¡hackeræ²¡æœ‰é…ç½®TrustedToAuthForDelegationä½å’ŒmsDS-AllowedToDelegateTo å­—æ®µï¼Œå› æ­¤è¿”å›çš„TGSç¥¨æ®æ˜¯ä¸å¯è½¬å‘çš„</p><p>å¦‚å›¾</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/step2.png" alt="step2" tabindex="0" loading="lazy"><figcaption>step2</figcaption></figure><blockquote><p>ï¼ˆè¿™ä¸€æ­¥å°±åŒºåˆ«ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ï¼Œåœ¨S4U2SELFé‡Œé¢æåˆ°ï¼Œè¿”å›çš„TGSå¯è½¬å‘çš„ä¸€ä¸ªæ¡ä»¶æ˜¯æœåŠ¡1é…ç½®äº†ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ï¼Œkdcä¼šæ£€æŸ¥æœåŠ¡1 çš„TrustedToAuthForDelegationä½å’ŒmsDS-AllowedToDelegateTo è¿™ä¸ªå­—æ®µï¼Œç”±äºåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œæ˜¯åœ¨æœåŠ¡2é…ç½®ï¼ŒæœåŠ¡2çš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§é…ç½®äº†æœåŠ¡1çš„sidï¼‰</p></blockquote></li><li><p>æœåŠ¡hackerä»£æ›¿ç”¨æˆ·å»è¯·æ±‚æœåŠ¡ï¼Œè·å–æŒ‡å®šæœåŠ¡çš„TGSç¥¨æ®ï¼Œå¹¶ä¸”ç”±äºé…ç½®äº†åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œç”³è¯·åˆ°çš„TGSç¥¨æ®æ˜¯å¯è½¬å‘çš„</p><p>å¦‚å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/uu2fu3o/blog-picture/main/ass/step3.png" alt="step3" tabindex="0" loading="lazy"><figcaption>step3</figcaption></figure></li></ul><h2 id="å‚è€ƒé“¾æ¥" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥"><span>å‚è€ƒé“¾æ¥</span></a></h2><p><a href="https://daiker.gitbook.io/windows-protocol/kerberos/2#3.-enc_part" target="_blank" rel="noopener noreferrer">https://daiker.gitbook.io/windows-protocol/kerberos/2#3.-enc_part</a></p><p><a href="https://shu1l.github.io/2020/08/05/kerberos-yu-wei-pai-gong-ji-xue-xi/#%E9%9D%9E%E7%BA%A6%E6%9D%9F%E6%80%A7%E5%A7%94%E6%B4%BE" target="_blank" rel="noopener noreferrer">https://shu1l.github.io/2020/08/05/kerberos-yu-wei-pai-gong-ji-xue-xi/#éçº¦æŸæ€§å§”æ´¾</a></p><p><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/1fb9caca-449f-4183-8f7a-1a5fc7e7290a" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/1fb9caca-449f-4183-8f7a-1a5fc7e7290a</a></p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/æ¸—é€æµ‹è¯•/Kerberosä¸“é¢˜/TGS_REQ&amp;TGS_REPé˜¶æ®µè¯¦è§£.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/1/16 02:41:02</span></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 1027578439@qq.com">uu2fu3o</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/articles/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Kerberos%E4%B8%93%E9%A2%98/TGS_REQ_TGS_REP%E9%98%B6%E6%AE%B5%E6%94%BB%E5%87%BB.html" aria-label="TGS_REQ&amp;TGS_REPé˜¶æ®µæ”»å‡»"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->TGS_REQ&amp;TGS_REPé˜¶æ®µæ”»å‡»</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">è¿™æ˜¯ä¸ªé¡µè„š</div><div class="vp-copyright">Copyright Â© 2025 uu2fu3o </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/articles/assets/app-DS0ZCcmM.js" defer></script>
  </body>
</html>
